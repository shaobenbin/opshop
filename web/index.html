<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>OpsHop // ASSET_MANAGER</title>
	<link rel="stylesheet" href="/static/css/style.css">
	<script src="/static/lib/vue.global.js"></script>
	<script src="/static/lib/Sortable.min.js"></script>
	<script src="/static/lib/vuedraggable.umd.min.js"></script>
</head>
<body>
<div id="app" style="display: contents;">
	<aside class="sidebar">
		<div class="sidebar-header">OPSHOP // V0.1.1</div>
		<div class="lang-switcher">
			<span :class="['lang-btn', lang === 'zh' ? 'active' : '']" @click="setLang('zh')">‰∏≠</span>
			<span :class="['lang-btn', lang === 'en' ? 'active' : '']" @click="setLang('en')">EN</span>
		</div>
		<div style="flex:1; overflow-y:auto;">
			<div v-for="ws in config.workspaces" :key="ws.id"
				 :class="['ws-item', currentWsId === ws.id ? 'active' : '']" @click="currentWsId = ws.id">
				üìÅ {{ ws.name }}
			</div>
		</div>
		<div style="padding:20px; border-top:1px solid var(--border);">
			<button class="btn" style="width:100%" @click="addWorkspace">+ {{ t('new_ws') }}</button>
		</div>
	</aside>

	<main class="main">
		<div class="dashboard-header" v-if="currentWorkspace">
			<h1>{{ currentWorkspace.name }}</h1>
		</div>

		<div class="grid" v-if="currentWorkspace">
			<node-card
				v-for="node in currentWorkspace.nodes"
				:key="node.id"
				:node="node"
				:t="t"
				:all-node-providers="config.node_providers"
				:all-projects="config.projects"
				:all-langs="config.langs"
				:all-app-types="config.app_types"
				@edit-node="editNode"
				@delete-node="deleteNode"
				@add-user="addUser"
				@edit-user="editUser"
				@delete-user="deleteUser"
				@add-app="addApp"
				@edit-app="openAppEditor"
				@delete-app="deleteApp"
				@save-config="saveConfig">
			</node-card>
			<div class="add-unit-placeholder" @click="addNode">
				[ + {{ t('add_node') }} ]
			</div>
		</div>
	</main>

	<!-- Modals -->
	<node-modal
		v-if="editingNode"
		:node="editingNode"
		:t="t"
		:all-node-providers="config.node_providers"
		@close="editingNode = null"
		@save="saveNodeEdit">
	</node-modal>

	<user-modal v-if="editingUser" :user="editingUser" :t="t" @close="editingUser = null" @save="saveUserEdit"></user-modal>

	<app-modal
		v-if="editingApp"
		:app="editingApp" :t="t"
		:lang-options="langOptions"
		:type-options="typeOptions"
		:all-projects="config.projects"
		:all-langs="config.langs"
		:all-app-types="config.app_types"
		@create-global-item="handleCreateGlobalItem"
		@close="editingApp = null"
		@save="saveAppEdit">
	</app-modal>
</div>

<script src="/static/js/i18n.js"></script>
<script src="/static/js/components/NodeCard.js"></script>
<script src="/static/js/components/NodeModal.js"></script>
<script src="/static/js/components/UserModal.js"></script>
<script src="/static/js/components/AppModal.js"></script>
<script src="/static/js/app.js"></script>
</body>
</html>
